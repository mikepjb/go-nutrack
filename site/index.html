<html>
  <head>
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet"> 
    <link rel="stylesheet" type="text/css" href="/style.css">
  </head>
  <body>
    <nav>Nutrack <a class="btn">New</a></nav>

      <header>
        <div class="content-width">
          <div>
            <span>Spend</span>
            <span id="spend-total"></span>
          </div>

          <div>
            <span>Nutrition</span>
            <span id="nutrition-total"></span>
          </div>

          <div>
            <span>Totals</span>
            <span id="totals-chart">totals for pcfs & vitamins etc</span>
          </div>
        </div>
      </header>

      <div class="content-width">
        <section id="foodItems">
          <h4>Food Items</h4>
        </section>

        <section id="orders">
          <h4>Orders</h4>
        </section>

        <section id="recipes">
          <h4>Recipes</h4>
        </section>
      </div>
  </body>
  <script>
    var nutrientJSON

    function drawFoodItems(foodItemsUsed, total) {
      var table = document.createElement("table")

      var thead = document.createElement("thead")
      var tr = document.createElement("tr")

      var td = document.createElement("td")
      var text = document.createTextNode("Name")
      td.appendChild(text)
      tr.appendChild(td)

      var td = document.createElement("td")
      var text = document.createTextNode("Amount")
      td.appendChild(text)
      tr.appendChild(td)

      var td = document.createElement("td")
      var text = document.createTextNode("Cost")
      td.appendChild(text)
      tr.appendChild(td)
      thead.appendChild(tr)
      table.appendChild(thead)

      foodItemsUsed.forEach(function(fi) {
        var tr = document.createElement("tr")

        var td = document.createElement("td")
        var text = document.createTextNode(fi.Name)
        td.appendChild(text)
        tr.appendChild(td)

        var td = document.createElement("td")
        var text = document.createTextNode(fi.Amount + "g")
        td.appendChild(text)
        tr.appendChild(td)

        var td = document.createElement("td")
        var text = document.createTextNode("£" + fi.Price.toFixed(2))
        td.appendChild(text)
        tr.appendChild(td)

        table.appendChild(tr)
      })

      var tr = document.createElement("tr")

      var td = document.createElement("td")
      var text = document.createTextNode("Total")
      td.appendChild(text)
      tr.appendChild(td)

      var td = document.createElement("td")
      var text = document.createTextNode("--")
      td.appendChild(text)
      tr.appendChild(td)

      var td = document.createElement("td")
      var text = document.createTextNode("£" + total.toFixed(2))
      td.appendChild(text)
      tr.appendChild(td)

      table.appendChild(tr)

      var rdiv = document.getElementById("foodItems")
      rdiv.appendChild(table)
    }

    function drawOrders(orders) {
      orders.forEach(function(o) {
        var e = document.createElement("h5")
        var text = document.createTextNode(o.Name)
        e.appendChild(text)
        var odiv = document.getElementById("orders")
        odiv.appendChild(e)

        o.Recipes.forEach(function(r) {
          var e = document.createElement("div")
          var text = document.createTextNode(r.Name)
          e.appendChild(text)
          odiv.appendChild(e)
        })
      })
    }

    function drawRecipes(recipes) {
      recipes.forEach(function(r) {
        var e = document.createElement("div")
        var text = document.createTextNode(r.Name)
        e.appendChild(text)
        var rdiv = document.getElementById("recipes")
        rdiv.appendChild(e)
      })
    }

    function update(id, value) {
      document.getElementById(id).innerHTML = value
    }

    function loadNutritionJSON() {
      var xhr = new XMLHttpRequest();
      xhr.open("GET", "calculate", true);
      xhr.onload = function() {
        console.log("loading nutrient json");
        nutrientJSON = JSON.parse(this.responseText);

        drawFoodItems(nutrientJSON.Stats.FoodItemUse,
          nutrientJSON.Stats.TotalPriceOfIngredients)
        drawOrders(nutrientJSON.Orders)
        drawRecipes(nutrientJSON.Recipes)
        update("spend-total",
          "£"+nutrientJSON.Stats.TotalPriceOfIngredients.toFixed(2))
        update("nutrition-total",
          nutrientJSON.Stats.DailyNutrition.Energy.toFixed(0)+" / "+nutrientJSON.Stats.TargetDailyNutrition.Energy.toFixed(0))
      }
      xhr.send();
    }

    loadNutritionJSON()
  </script>
</html>
